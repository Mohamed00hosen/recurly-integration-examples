<!DOCTYPE html>
<html>

<head>
  <title>Bank Redirect Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://js.recurly.com/v4/recurly.js"></script>
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
</head>

<body>
  <h1>Bank Redirect</h1>

  <form onsubmit="return false;" style="display: none;">
    <div>
      <p>Amount:</p>
      <input type="number" id="amount" name="amount" placeholder="Amount">
    </div>

    <div>
      <p>Payment Method Type:</p>
      <select id="payment_method_type" name="payment_method_type">
        <option value="ideal">ideal</option>
      </select>
    </div>

    <div>
      <p>Bank:</p>
      <select id="bank" name="bank"></select>
    </div>

    <button onclick="purchase()">Purchase</button>
  </form>

  <script>
    // Configure recurly.js -- set this to your own public key
    recurly.configure(window.recurlyConfig.publicKey);

    // Create BankRedirect instance
    var bankRedirect = recurly.BankRedirect();

    // Listen for successful token event and log response
    bankRedirect.on('token', function (response) {
      console.log('TOKEN: ', response);
      alert(`TOKEN: ${response}`);
    });

    // If an error occurs, log it
    bankRedirect.on('error', function (error) {
      console.log('ERROR: ', error);
      alert(`ERROR: ${error}`);
    });

    // Listen for successful banks response
    bankRedirect.on('banks', function ({ banks }) {
      console.log('BANKS: ', banks);
      document.querySelector('form').style.display = 'block';
    });

    // If an error occurs loading the banks, log it
    bankRedirect.on('banks-error', function (error) {
      console.log('Banks ERROR: ', error);
      alert(`Banks ERROR: ${error}`);
    });

    // load banks
    bankRedirect.loadBanks({
      payment_method_type: document.querySelector('#payment_method_type').value
    }, '#bank')

    // Purchase
   function purchase() {
    bankRedirect.start({
      amount: document.querySelector('#amount').value,
      payment_method_type: document.querySelector('#payment_method_type').value,
      issuer_id: document.querySelector('#bank').value
    });
   }
  </script>
</body>

</html>
